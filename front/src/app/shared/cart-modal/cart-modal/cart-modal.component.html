<div id="cartModal" class="modal-backdrop" (click)="onCloseClick()"></div>
<div class="cart-modal">
  <div class="cart-modal-content">

    <!-- En-tÃªte -->
    <div class="cart-modal-header">
      <h3>ðŸ›’ Panier</h3>
      <button class="close-btn" (click)="onCloseClick()">âœ–</button>
    </div>

    <!-- Liste des produits -->
    <div class="cart-items" *ngIf="cartItems.length > 0; else emptyCart">
      <div class="cart-item" *ngFor="let item of cartItems">
        <img [src]="item.product?.image" alt="Produit" width="60" height="60" />
        <div class="cart-item-info">
          <h5 class="cart-item-title">{{ item.product?.name }}</h5>
          <div class="quantity-control">
            <button class="qty-btn small minus" (click)="decreaseQuantity(item)">âˆ’</button>
            <span class="qty-value">{{ item.quantity }}</span>
            <button class="qty-btn small plus" (click)="increaseQuantity(item)">+</button>
          </div>
          <p class="cart-item-price">{{ item.product?.price }} DT x {{ item.quantity }}</p>
        </div>
        <button class="remove-item-btn" (click)="removeFromCart(item.id)">ðŸ—‘</button>
      </div>
    </div>

    <ng-template #emptyCart>
      <p class="empty-cart-text">Votre panier est vide.</p>
    </ng-template>

    <!-- Section confirmation + total -->
    <div *ngIf="cartItems.length > 0" class="confirm-section">
      <hr />
      <div class="total-price-section">
        <p>Total : <strong>{{ totalPrice | number:'1.2-2' }} TND</strong></p>
      </div>

      <button class="confirm-btn" (click)="toggleConfirmForm()">Confirmer la commande</button>

      <!-- Formulaire finalisation -->
      <div *ngIf="showConfirmForm" class="card-confirmation">
        <h5 class="card-title">Finaliser votre commande</h5>

        <input type="text" placeholder="Nom complet" [formControl]="nameControl" class="form-input" />
        <div *ngIf="orderForm.get('name')?.invalid && orderForm.get('name')?.touched" class="error">Nom requis</div>

        <input type="email" placeholder="Email" [formControl]="emailControl" class="form-input" />
        <div *ngIf="orderForm.get('email')?.invalid && orderForm.get('email')?.touched" class="error">Email invalide</div>

        <input type="tel" placeholder="TÃ©lÃ©phone" [formControl]="phoneControl" class="form-input"
          maxlength="8" pattern="[0-9]*" inputmode="numeric" (keypress)="$event.charCode >= 48 && $event.charCode <= 57" />
        <div *ngIf="orderForm.get('phone')?.invalid && orderForm.get('phone')?.touched" class="error">NumÃ©ro de tÃ©lÃ©phone invalide</div>

        <input type="text" placeholder="Localisation" [formControl]="localisationControl" class="form-input" />
        <div *ngIf="orderForm.get('localisation')?.invalid && orderForm.get('localisation')?.touched" class="error">Localisation requise</div>

        <button (click)="confirmOrder()" [disabled]="orderForm.invalid" class="confirm-btn">Envoyer</button>
      </div>

    </div>
    
  </div>
</div>
